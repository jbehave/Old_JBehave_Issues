<!DOCTYPE html><html class="mozilla"><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252">
    






<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<title>[JBEHAVE-739] NumberFormatException when trying to convert parameters to BigDecimal with German Locale - jira.codehaus.org</title>
<script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>













































    




<link rel="shortcut icon" href="index_files/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="https://jira.codehaus.org/osd.jsp" title="[JBEHAVE-739] NumberFormatException when trying to convert parameters to BigDecimal with German Locale - jira.codehaus.org">

    


<!--[if IE]><![endif]-->
<script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>
<link type="text/css" rel="stylesheet" href="index_files/batch.css" media="all">
<!--[if lte IE 8]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_UK-huda6k-1988229788/6162/7/9/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+8" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_UK-huda6k-1988229788/6162/7/9/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="index_files/batch-1.css" media="all">
<script type="text/javascript" src="index_files/batch.js"></script><style type="text/css"></style>
<!--[if lte IE 8]>
<script type="text/javascript" src="/s/d41d8cd98f00b204e9800998ecf8427e/en_UK-huda6k-1988229788/6162/7/9/_/download/superbatch/js/batch.js?conditionalComment=lte+IE+8" ></script>
<![endif]-->
<script type="text/javascript" src="index_files/batch-1.js"></script>
<script type="text/javascript" src="index_files/jira.webresources_calendar-en.js"></script>
<script type="text/javascript" src="index_files/com.atlassian.administraticksearch-webresources.js"></script>

<script type="text/javascript" src="index_files/shortcuts.js"></script>


    
    
    
    <meta name="decorator" content="atl.general">
    <meta id="isNavigator" name="isNavigator" content="true">
    <meta name="ajs-user.search.mode" content="basic">
    <meta name="ajs-issue-search-help-title" content="Searching for Issues">
    <meta name="ajs-issue-search-help-url" content="https://docs.atlassian.com/jira/docs-061/Searching+for+Issues">
    <meta name="ajs-advanced-search-help-title" content="Performing Advanced Searches">
    <meta name="ajs-advanced-search-help-url" content="https://docs.atlassian.com/jira/docs-061/Advanced+Searching">
    
</head>
<body data-aui-version="5.1.8" id="jira" class="aui-layout aui-theme-default ka ajax-issue-search-and-view page-type-navigator navigator-issue-only" data-version="6.1.6">
<div id="page">
    <header id="header" style="display:none" role="banner">
        



    
        
            
        
    







        




        





<fieldset class="parameters hidden dont-default-focus">
    <input title="tzdetect.pref.tzid" value="America/Chicago" type="hidden">
    <input title="tzdetect.pref.tzname" value="(GMT-06:00) Chicago" type="hidden">
    <input title="tzdetect.pref.tzoffset" value="(GMT-06:00)" type="hidden">
    <input title="tzdetect.pref.tzdst" value="true" type="hidden">
    <input title="tzdetect.pref.nothanks" value="" type="hidden">
</fieldset>
<nav data-aui-responsive="true" class="aui-header aui-dropdown2-trigger-group" role="navigation"><div class="aui-header-inner"><div class="aui-header-before"><a class="aui-dropdown2-trigger app-switcher-trigger" aria-owns="app-switcher" aria-haspopup="true" tabindex="0"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a><div id="app-switcher" class="aui-dropdown2 aui-style-default"><div class="aui-dropdown2-section"><ul class="nav-links"><li class="nav-link nav-link-local"><a href="https://jira.codehaus.org/" class="aui-dropdown2-radio interactive checked" title="https://jira.codehaus.org/"><span class="nav-link-label">jira.codehaus.org</span></a></li><li class="nav-link"><a href="http://jira.sonarsource.com/" class="aui-dropdown2-radio interactive" title="http://jira.sonarsource.com/"><span class="nav-link-label">SonarSource</span></a></li><li class="nav-link"><a href="http://docs.codehaus.org/" class="aui-dropdown2-radio interactive" title="http://docs.codehaus.org/"><span class="nav-link-label">Codehaus</span></a></li><li class="nav-link"><a href="http://xircles.codehaus.org/" class="aui-dropdown2-radio interactive" title="http://xircles.codehaus.org"><span class="nav-link-label">Xircles</span></a></li></ul></div></div><script><!--
/* Script removed by snapshot save */
--></script></div><div class="aui-header-primary"><h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://jira.codehaus.org/secure/MyJiraHome.jspa"><img data-aui-responsive-header-index="0" src="urn:download-error:http://www.codehaus.org/codehaus-small.gif" alt="jira.codehaus.org"></a></h1><ul style="width: auto;" class="aui-nav">




<li><a class="aui-nav-link aui-dropdown2-ajax jira-ajax-menu aui-dropdown2-trigger " href="https://jira.codehaus.org/secure/Dashboard.jspa" id="home_link" accesskey="d" title="View and manage your dashboards" aria-haspopup="true" aria-owns="home_link-content">Dashboards</a><div id="home_link-content" class="aui-dropdown2 aui-style-default" data-aui-dropdown2-ajax-key="home_link"></div></li><li><a class="aui-nav-link aui-dropdown2-ajax jira-ajax-menu aui-dropdown2-trigger " href="/Old_JBehave_Issues/index.html" id="browse_link" accesskey="p" title="View recent projects and browse a list of projects" aria-haspopup="true" aria-owns="browse_link-content">Projects</a><div id="browse_link-content" class="aui-dropdown2 aui-style-default" data-aui-dropdown2-ajax-key="browse_link"></div></li><li><a class="aui-nav-link aui-dropdown2-ajax jira-ajax-menu aui-dropdown2-trigger " href="https://jira.codehaus.org/secure/IssueNavigator.jspa" id="find_link" accesskey="i" title="Search for issues and view recent issues" aria-haspopup="true" aria-owns="find_link-content">Issues</a><div id="find_link-content" class="aui-dropdown2 aui-style-default" data-aui-dropdown2-ajax-key="find_link"></div></li>
<li style="display: none;"><a id="aui-responsive-header-dropdown-trigger-0" class="aui-dropdown2-trigger" aria-owns="aui-responsive-header-dropdown-content-0" aria-haspopup="true" href="#">More<span class="icon aui-icon-dropdown"></span></a><div id="aui-responsive-header-dropdown-content-0" class="aui-dropdown2 aui-style-default"><div class="aui-dropdown2-section"><ul id="aui-responsive-header-dropdown-list-0"></ul></div></div></li></ul></div><div class="aui-header-secondary"><ul class="aui-nav"><li>
    <form action="https://jira.codehaus.org/secure/QuickSearch.jspa" method="post" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt">
        <input id="quickSearchInput" class="search" title="Quick Search ( Type '/' )" placeholder="Quick Search" name="searchString" accesskey="q" type="text">
        <input class="hidden" value="Search" type="submit">
    </form>
</li>



    <li id="system-help-menu">
        <a class="aui-nav-link aui-dropdown2-trigger" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/docs-061/JIRA+Documentation" target="_blank" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a>
        <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default">
                            <div class="aui-dropdown2-section">
                                                                <ul id="jira-help" class="aui-list-truncate">
                                                            <li>
                                    <a id="view_help" class="interactive" title="Goto the online documentation for JIRA" href="https://docs.atlassian.com/jira/docs-061/JIRA+Documentation" target="_blank">Online Help</a>
                                </li>
                                                            <li>
                                    <a id="keyshortscuthelp" class="interactive" title="Get more information about JIRA's Keyboard Shortcuts ( Type '?' )" href="https://jira.codehaus.org/secure/ViewKeyboardShortcuts%21default.jspa" target="_blank">Keyboard Shortcuts</a>
                                </li>
                                                            <li>
                                    <a id="view_about" class="interactive" title="Get more information about JIRA" href="https://jira.codehaus.org/secure/AboutPage.jspa">About JIRA</a>
                                </li>
                                                            <li>
                                    <a id="view_credits" class="interactive" title="See who did what" href="https://jira.codehaus.org/secure/JiraCreditsPage%21default.jspa" target="_blank">JIRA Credits</a>
                                </li>
                                                            <li>
                                    <a id="whats-new-menu-link" class="interactive" href="https://docs.atlassian.com/jira/docs-061/whatsnew/iframe">What?s New</a>
                                </li>
                                                    </ul>
                                    </div>
                    </div>
    </li>









<li id="user-options">
            <a class="aui-nav-link login-link" href="https://jira.codehaus.org/login.jsp?os_destination=%2Fbrowse%2FJBEHAVE-739">Log In</a>
                <div id="user-options-content" class="aui-dropdown2 aui-style-default">
                            <div class="aui-dropdown2-section">
                                                        </div>
                    </div>
    </li>
</ul></div></div><!-- .aui-header-inner--></nav><!-- .aui-header -->
    </header>
    


<div id="announcement-banner" class="alertHeader">
    <div style="position: absolute; right: 20em; top: -2em">
  <a href="https://xircles.codehaus.org/signup">Signup</a>
</div>
</div>


    <section id="content" role="main">
        
    

    <div class="issue-container ">
                                    <div id="issue-content" class="issue-edit-form">
                    <header id="stalker" class="issue-header js-stalker">
                        <div class="issue-header-content"><header class="aui-page-header"><div class="aui-page-header-inner"><div class="aui-page-header-image"><span id="10680" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="JBehave" src="index_files/projectavatar.png"></span></span></div><!-- .aui-page-header-image --><div class="aui-page-header-main"><ol class="aui-nav aui-nav-breadcrumbs"><li><a id="project-name-val" href="/Old_JBehave_Issues/index.html">JBehave</a></li><li><a class="issue-link" data-issue-key="JBEHAVE-739" href="#" id="key-val" rel="135157">JBEHAVE-739</a></li></ol><h1 id="summary-val">NumberFormatException when trying to convert parameters to BigDecimal with German Locale</h1></div><!-- .aui-page-header-main --><div class="aui-page-header-actions"><div id="issue-header-pager"></div></div><!-- .aui-page-header-actions --></div><!-- .aui-page-header-inner --></header><!-- .aui-page-header --><div class="command-bar"><div class="ops-cont"><div class="ops-menus aui-toolbar"><div class="toolbar-split toolbar-split-left"><ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops"><li class="toolbar-item"><a id="ops-login-lnk" style="display:none" title="Log In" class="toolbar-trigger" href="https://jira.codehaus.org/login.jsp?os_destination=%2Fbrowse%2FJBEHAVE-739"><span class="trigger-label">Log In</span></a></li></ul><ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul><ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul><ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul></div><div class="toolbar-split toolbar-split-right"><ul id="opsbar-jira.issue.tools" style="display:none" class="toolbar-group pluggable-ops"><li class="toolbar-item toolbar-dropdown"><div><a href="#" id="viewissue-export" title="Export this issue in another format" data-hide-on-scroll=".split-view .issue-container" data-contain-to-window="true" class="toolbar-trigger  js-default-dropdown"><span class="icon icon-export viewissue-export"></span> <span class="dropdown-text">Export</span><span class="icon drop-menu"></span></a><div class="aui-list hidden"><ul class="aui-list-section aui-first aui-last"><li class="aui-list-item"><a href="https://jira.codehaus.org/si/jira.issueviews:issue-xml/JBEHAVE-739/JBEHAVE-739.xml" class="aui-list-item-link" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li><li class="aui-list-item"><a href="https://jira.codehaus.org/si/jira.issueviews:issue-word/JBEHAVE-739/JBEHAVE-739.doc" class="aui-list-item-link" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li><li class="aui-list-item"><a href="https://jira.codehaus.org/si/jira.issueviews:issue-html/JBEHAVE-739/JBEHAVE-739.html" class="aui-list-item-link" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li></ul></div></div></li></ul></div></div></div></div></div>
                    </header>
                    <div class="issue-body-content">
                        <div class="aui-group issue-body"><div class="aui-item issue-main-column"><div id="details-module" class="module toggle-wrap"><div id="details-module_heading" class="mod-header"><ul class="ops"></ul><h2 class="toggle-title">Details</h2></div><div class="mod-content">




<ul id="issuedetails" class="property-list two-cols">
    <li class="item">
        <div class="wrap">
            <strong class="name">Type:</strong>
            <span id="type-val" class="value">
                                <img alt="Bug" src="index_files/bug.png" title="Bug - A problem which impairs or prevents the functions of the product." height="16" width="16"> Bug
            </span>
        </div>
    </li>
    <li class="item item-right">
        <div class="wrap">
            <strong class="name">Status:</strong>
            <span id="status-val" class="value">
                                

<img src="index_files/resolved.png" alt="Resolved" title="Resolved - A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed." height="16" width="16"> Resolved
            </span>
                    </div>
    </li>
            <li class="item">
            <div class="wrap">
                <strong class="name">Priority:</strong>
                <span id="priority-val" class="value">
                                        <img alt="Major" src="index_files/major.png" title="Major - Major loss of function." height="16" width="16"> Major
                </span>
            </div>
        </li>
                                <li class="item item-right">
            <div class="wrap">
                <strong class="name">Resolution:</strong>
                <span id="resolution-val" class="value resolved">
                                     Fixed
                                </span>
            </div>
        </li>
                <li class="item">
            <div class="wrap">
                <strong class="name">Affects Version/s:</strong>
                <span id="versions-val" class="value">
                                            <span style="height: auto;" class="shorten" id="versions-field">
                                                            <span title="3.5.4 ">3.5.4</span>                                                    </span>
                                    </span>
            </div>
        </li>
                <li class="item item-right">
            <div class="wrap">
                <strong class="name">Fix Version/s:</strong>
                <span id="fixfor-val" class="value">
                                            <span style="height: auto;" class="shorten" id="fixVersions-field">
                                                            <a href="/Old_JBehave_Issues/index.html/fixforversion/17721" title="3.6 ">3.6</a>                                                    </span>
                                    </span>
            </div>
        </li>
                <li class="item">
            <div class="wrap">
                <strong class="name">Component/s:</strong>
                <span id="components-val" class="value">
                                            <span style="height: auto;" class="shorten" id="components-field">
                                                            <a href="/Old_JBehave_Issues/index.html/component/11086" title="Core ">Core</a>                                                    </span>
                                    </span>
            </div>
        </li>
                    <li class="item full-width">
            <div class="wrap" id="wrap-labels">
                <strong class="name">Labels:</strong>
                    <div class="labels-wrap value">
            <span class="labels" id="labels-135157-value">None</span>
                </div>
            </div>
        </li>
        </ul>

<div id="customfieldmodule">
    <div class="aui-tabs horizontal-tabs" id="customfield-tabs">
                    <div id="customfield-panel-1" class="tabs-pane active-pane">
                        <ul class="property-list">
                                                <li id="rowForcustomfield_10110" class="item">
                        <div class="wrap">
                            <strong title="Testcase included" class="name">Testcase included:</strong>
                            <div id="customfield_10110-val" class="value type-radiobuttons" data-fieldtype="radiobuttons" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                                    yes

                            </div>
                        </div>
                    </li>
                                                                <li id="rowForcustomfield_10210" class="item">
                        <div class="wrap">
                            <strong title="Number of attachments " class="name">Number of attachments :</strong>
                            <div id="customfield_10210-val" class="value type-attachments" data-fieldtype="attachments" data-fieldtypecompletekey="com.atlassian.jira.toolkit:attachments">
                                    0

                            </div>
                        </div>
                    </li>
                                        </ul>
        </div>
        </div></div>
</div></div><div id="descriptionmodule" class="module toggle-wrap"><div id="descriptionmodule_heading" class="mod-header"><ul class="ops"></ul><h2 class="toggle-title">Description</h2></div><div class="mod-content"><div id="description-val" class="field-ignore-highlight">
    <div class="user-content-block">
                    <p>When using a German localized number with group separators and decimals, a conversion to BigDecimal fails with a <tt>NumberFormatException</tt>. For German, group separators are dots, decimal separator is a comma (just the other way round of the US version). </p>

<p>In the following test class, the first case is green, the second fails with</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>org.jbehave.core.steps.ParameterConverters$ParameterConvertionFailed: 1.000.000,01
	at org.jbehave.core.steps.ParameterConverters$NumberConverter.convertValue(ParameterConverters.java:256)
	at de.westlb.jets.xce.jbehave.tools.NumberFormatTest.jbehaveConverter(NumberFormatTest.java:39)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.junit.internal.runners.TestMethodRunner.executeMethodBody(TestMethodRunner.java:99)
        ...
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)
Caused by: java.lang.NumberFormatException
	at java.math.BigDecimal.&lt;init&gt;(BigDecimal.java:453)
	at java.math.BigDecimal.&lt;init&gt;(BigDecimal.java:728)
	at org.jbehave.core.steps.ParameterConverters$NumberConverter.convertValue(ParameterConverters.java:247)
	... 21 more
</pre>
</div></div>

<p>Putting a breakpoint in the BigDecimal constructor reveals it is fed a String "1.000.000.000.00" which is obviously wrong. I suspect, the "canonicalization" of the original String breaks it.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Test.java</b></div><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class NumberFormatTest {

	<span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> BigDecimal EXPECTED = <span class="code-keyword">new</span> BigDecimal(<span class="code-quote">"1000000.01"</span>);
	<span class="code-keyword">private</span> <span class="code-keyword">final</span> <span class="code-object">String</span> localizedString = <span class="code-quote">"1.000.000,01"</span>;
	<span class="code-keyword">private</span> DecimalFormat germanNumbers;

	@Before
	<span class="code-keyword">public</span> void setup() {
		germanNumbers = (DecimalFormat) DecimalFormat
				.getNumberInstance(Locale.GERMAN);
		germanNumbers.setParseBigDecimal(<span class="code-keyword">true</span>);

	}

	@Test
	<span class="code-keyword">public</span> void plainConverter() <span class="code-keyword">throws</span> Exception {
		<span class="code-object">Number</span> parse = germanNumbers.parse(localizedString);
		assertEquals(EXPECTED, parse);
	}

	@Test
	<span class="code-keyword">public</span> void jbehaveConverter() <span class="code-keyword">throws</span> Exception {
		ParameterConverters.NumberConverter numberConverter = <span class="code-keyword">new</span> ParameterConverters.NumberConverter(
				germanNumbers);
		<span class="code-object">Object</span> v = numberConverter.convertValue(localizedString,
				BigDecimal.class);
		assertEquals(EXPECTED, v);

	}
</pre>
</div></div>
            </div>
</div>
</div></div><div id="activitymodule" class="module toggle-wrap"><div id="activitymodule_heading" class="mod-header"><ul class="ops"></ul><h2 class="toggle-title">Activity</h2></div><div class="mod-content">










    <div class="tabwrap tabs2" style="display:none">
                    <div class="sortwrap">
                                    <a class="icon icon-sort-down ajax-activity-content" rel="nofollow" href="/Old_JBehave_Issues/739?actionOrder=desc" title="Ascending order - Click to sort in descending order"><span>Ascending order - Click to sort in descending order</span></a>
                            </div>
                <ul id="issue-tabs" class="tabs horizontal">
                                
            <li class="active" id="all-tabpanel" data-id="all-tabpanel" data-key="com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel" data-label="All" data-href="/browse/JBEHAVE-739">
                            <strong>All</strong>
                        </li>
                                
            <li data-id="comment-tabpanel" data-key="com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel" data-label="Comments" data-href="/browse/JBEHAVE-739">
                            <a class="ajax-activity-content" id="comment-tabpanel" href="/Old_JBehave_Issues/739"><strong>Comments</strong></a>
                        </li>
                                
            <li data-id="worklog-tabpanel" data-key="com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel" data-label="Work Log" data-href="/browse/JBEHAVE-739">
                            <a class="ajax-activity-content" id="worklog-tabpanel" href="/Old_JBehave_Issues/739"><strong>Work Log</strong></a>
                        </li>
                                
            <li data-id="changehistory-tabpanel" data-key="com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel" data-label="History" data-href="/browse/JBEHAVE-739">
                            <a class="ajax-activity-content" id="changehistory-tabpanel" href="/Old_JBehave_Issues/739"><strong>History</strong></a>
                        </li>
                                
            <li data-id="activity-stream-issue-tab" data-key="com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab" data-label="Activity" data-href="/browse/JBEHAVE-739">
                            <a class="ajax-activity-content" id="activity-stream-issue-tab" href="/Old_JBehave_Issues/739"><strong>Activity</strong></a>
                        </li>
                </ul>
    </div>
    <div class="issuePanelWrapper">
        <div class="issuePanelProgress"></div>
        <div class="issuePanelContainer" id="issue_actions_container">
                                    


<div id="comment-293853" class="issue-data-block activity-comment twixi-block  expanded">
    <div class="twixi-wrap verbose actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
            <div class="action-links">
                <a href="/Old_JBehave_Issues/739?focusedCommentId=293853&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-293853" title="A permanent link to this comment." class="icon icon-perma activitymodule-link"><span>Permalink</span></a>
                                            </div>
            <div class="action-details">        
    
    
    
                

    <a class="user-hover user-avatar" rel="brianrepko" id="commentauthor_293853_verbose" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=brianrepko"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Brian Repko</a>
 added a comment  - <span class="commentdate_293853_verbose subText"><span class="date user-tz" title="12/Mar/12 7:22 AM"><time class="livestamp" datetime="2012-03-12T07:22-0500">12/Mar/12 7:22 AM</time></span></span>  </div>
        </div>
        <div class="action-body flooded"><p>The default parameter converters use the default locale of the JVM - that is they are not specified when the Format is created.  What is the default locale that you are running under?</p>

<p>Also, the Format objects should not be held as instance variables as they are not thread-safe.  Just noticed that writing my own DateParameterConverter yesterday to do relative dates.  We should hold the patterns and create the format from the pattern.</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
            <div class="action-details flooded">
                        
    
    
    
                

    <a class="user-hover user-avatar" rel="brianrepko" id="commentauthor_293853_concise" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=brianrepko"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Brian Repko</a>
 added a comment  - <span class="commentdate_293853_concise subText"><span class="date user-tz" title="12/Mar/12 7:22 AM"><time class="livestamp" datetime="2012-03-12T07:22-0500">12/Mar/12 7:22 AM</time></span></span>                    The default parameter converters use the default locale of the JVM - that is they are not specified when the Format is created.  What is the default locale that you are running under? 

 Also, the Format objects should not be held as instance variables as they are not thread-safe.  Just noticed that writing my own DateParameterConverter yesterday to do relative dates.  We should hold the patterns and create the format from the pattern.              </div>
        </div>
    </div>
</div>
                             


<div id="comment-293854" class="issue-data-block activity-comment twixi-block  expanded">
    <div class="twixi-wrap verbose actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
            <div class="action-links">
                <a href="/Old_JBehave_Issues/739?focusedCommentId=293854&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-293854" title="A permanent link to this comment." class="icon icon-perma activitymodule-link"><span>Permalink</span></a>
                                            </div>
            <div class="action-details">        
    
    
    
                

    <a class="user-hover user-avatar" rel="dschneller" id="commentauthor_293854_verbose" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=dschneller"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Daniel Schneller</a>
 added a comment  - <span class="commentdate_293854_verbose subText"><span class="date user-tz" title="12/Mar/12 7:29 AM"><time class="livestamp" datetime="2012-03-12T07:29-0500">12/Mar/12 7:29 AM</time></span></span>  </div>
        </div>
        <div class="action-body flooded"><p>If you look closely, in the 2nd test method, the <tt>numberConverter</tt> instance is created using the localized <tt>germanNumbers</tt> format. So I would expect it to be used. Apart from that, the default <tt>Locale</tt> of my system is <tt>de_DE</tt>.</p>

<p>As for the object itself, you are generally correct, of course. A long time ago I added the appropriate detector to FindBugs myself <img class="emoticon" src="index_files/smile.gif" alt="" height="16" align="absmiddle" border="0" width="16"></p>

<p>In this case, however, I am pretty sure the test is only run single-threaded, so no harm done. </p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
            <div class="action-details flooded">
                        
    
    
    
                

    <a class="user-hover user-avatar" rel="dschneller" id="commentauthor_293854_concise" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=dschneller"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Daniel Schneller</a>
 added a comment  - <span class="commentdate_293854_concise subText"><span class="date user-tz" title="12/Mar/12 7:29 AM"><time class="livestamp" datetime="2012-03-12T07:29-0500">12/Mar/12 7:29 AM</time></span></span>                    If you look closely, in the 2nd test method, the  numberConverter  instance is created using the localized  germanNumbers  format. So I would expect it to be used. Apart from that, the default  Locale  of my system is  de_DE . 

 As for the object itself, you are generally correct, of course. A long time ago I added the appropriate detector to FindBugs myself   

 In this case, however, I am pretty sure the test is only run single-threaded, so no harm done.               </div>
        </div>
    </div>
</div>
                             


<div id="comment-293855" class="issue-data-block activity-comment twixi-block  expanded">
    <div class="twixi-wrap verbose actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
            <div class="action-links">
                <a href="/Old_JBehave_Issues/739?focusedCommentId=293855&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-293855" title="A permanent link to this comment." class="icon icon-perma activitymodule-link"><span>Permalink</span></a>
                                            </div>
            <div class="action-details">        
    
    
    
                

    <a class="user-hover user-avatar" rel="dschneller" id="commentauthor_293855_verbose" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=dschneller"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Daniel Schneller</a>
 added a comment  - <span class="commentdate_293855_verbose subText"><span class="date user-tz" title="12/Mar/12 7:31 AM"><time class="livestamp" datetime="2012-03-12T07:31-0500">12/Mar/12 7:31 AM</time></span></span>  </div>
        </div>
        <div class="action-body flooded"><p>Sorry, misread your comment's first part, you were referring to the <tt>Locale</tt>, not the format. Nevertheless, the default is German  anyway.</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
            <div class="action-details flooded">
                        
    
    
    
                

    <a class="user-hover user-avatar" rel="dschneller" id="commentauthor_293855_concise" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=dschneller"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Daniel Schneller</a>
 added a comment  - <span class="commentdate_293855_concise subText"><span class="date user-tz" title="12/Mar/12 7:31 AM"><time class="livestamp" datetime="2012-03-12T07:31-0500">12/Mar/12 7:31 AM</time></span></span>                    Sorry, misread your comment's first part, you were referring to the  Locale , not the format. Nevertheless, the default is German  anyway.              </div>
        </div>
    </div>
</div>
                             


<div id="comment-293862" class="issue-data-block activity-comment twixi-block  expanded">
    <div class="twixi-wrap verbose actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
            <div class="action-links">
                <a href="/Old_JBehave_Issues/739?focusedCommentId=293862&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-293862" title="A permanent link to this comment." class="icon icon-perma activitymodule-link"><span>Permalink</span></a>
                                            </div>
            <div class="action-details">        
    
    
    
                

    <a class="user-hover user-avatar" rel="brianrepko" id="commentauthor_293862_verbose" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=brianrepko"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Brian Repko</a>
 added a comment  - <span class="commentdate_293862_verbose subText"><span class="date user-tz" title="12/Mar/12 8:22 AM"><time class="livestamp" datetime="2012-03-12T08:22-0500">12/Mar/12 8:22 AM</time></span></span>  </div>
        </div>
        <div class="action-body flooded"><p>Oh, sorry, just looked at the code and Locale.ENGLISH is the default in ParameterConverters.  You can can change that in the configuration by using/creating a new ParameterConverters and specifying the locale in the constructor.  It does NOT use the system default locale.</p>

<p>configuration.useParameterConverters(new ParameterConverters(configuration.stepMonitor(),Locale.GERMANY,",",false);</p>

<p>Let us know if configuring the ParameterConverters based on a "de_DE" locale works.</p>

<p>I also see that thread safety is sort of addressed there as well - but seems to be thread-safety around the manipulation of the list of parameter converters, not the converters themselves.</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
            <div class="action-details flooded">
                        
    
    
    
                

    <a class="user-hover user-avatar" rel="brianrepko" id="commentauthor_293862_concise" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=brianrepko"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Brian Repko</a>
 added a comment  - <span class="commentdate_293862_concise subText"><span class="date user-tz" title="12/Mar/12 8:22 AM"><time class="livestamp" datetime="2012-03-12T08:22-0500">12/Mar/12 8:22 AM</time></span></span>                    Oh, sorry, just looked at the code and Locale.ENGLISH is the default in ParameterConverters.  You can can change that in the configuration by using/creating a new ParameterConverters and specifying the locale in the constructor.  It does NOT use the system default locale. 

 configuration.useParameterConverters(new ParameterConverters(configuration.stepMonitor(),Locale.GERMANY,",",false); 

 Let us know if configuring the ParameterConverters based on a "de_DE" locale works. 

 I also see that thread safety is sort of addressed there as well - but seems to be thread-safety around the manipulation of the list of parameter converters, not the converters themselves.              </div>
        </div>
    </div>
</div>
                             


<div id="comment-293863" class="issue-data-block activity-comment twixi-block  expanded">
    <div class="twixi-wrap verbose actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
            <div class="action-links">
                <a href="/Old_JBehave_Issues/739?focusedCommentId=293863&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-293863" title="A permanent link to this comment." class="icon icon-perma activitymodule-link"><span>Permalink</span></a>
                                            </div>
            <div class="action-details">        
    
    
    
                

    <a class="user-hover user-avatar" rel="dschneller" id="commentauthor_293863_verbose" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=dschneller"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Daniel Schneller</a>
 added a comment  - <span class="commentdate_293863_verbose subText"><span class="date user-tz" title="12/Mar/12 8:47 AM"><time class="livestamp" datetime="2012-03-12T08:47-0500">12/Mar/12 8:47 AM</time></span></span>  </div>
        </div>
        <div class="action-body flooded"><p>Changed the 2nd test method like this:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Test.java</b></div><div class="codeContent panelContent">
<pre class="code-java">	@Test
	<span class="code-keyword">public</span> void jbehaveConverter() <span class="code-keyword">throws</span> Exception {
		<span class="code-comment">// http://jira.codehaus.org/browse/JBEHAVE-739
</span>		ParameterConverters parameterConverters = <span class="code-keyword">new</span> ParameterConverters(
				<span class="code-keyword">new</span> NullStepMonitor(), Locale.GERMANY, <span class="code-quote">","</span>, <span class="code-keyword">false</span>);

<span class="code-comment">//		ParameterConverters.NumberConverter numberConverter = <span class="code-keyword">new</span> ParameterConverters.NumberConverter(
</span>				germanNumbers);
<span class="code-comment">//		parameterConverters.addConverters(numberConverter);
</span>
		<span class="code-object">Object</span> v = parameterConverters.convert(localizedString, BigDecimal.class);
		assertEquals(EXPECTED, v);
	}
</pre>
</div></div>

<p>and it still fails with the same Exception. I tried with and without the two commented lines in the middle. Still the same error.</p>

<p>I do not think this is a problem of the Locale not getting picked up, but with the canonicalization of the String in <tt>org.jbehave.core.steps.ParameterConverters.NumberConverter.canonicalize(String)</tt> which seems to be producing the wrong "1.000.000.000.00" String (see that there is a lot of dots that will be mistaken for more than one decimal separators by the <tt>BigDecimal(String)</tt> constructor.</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
            <div class="action-details flooded">
                        
    
    
    
                

    <a class="user-hover user-avatar" rel="dschneller" id="commentauthor_293863_concise" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=dschneller"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Daniel Schneller</a>
 added a comment  - <span class="commentdate_293863_concise subText"><span class="date user-tz" title="12/Mar/12 8:47 AM"><time class="livestamp" datetime="2012-03-12T08:47-0500">12/Mar/12 8:47 AM</time></span></span>                    Changed the 2nd test method like this: 

   Test.java   
 
	@Test
	 public  void jbehaveConverter()  throws  Exception {
		 // http://jira.codehaus.org/browse/JBEHAVE-739
 		ParameterConverters parameterConverters =  new  ParameterConverters(
				 new  NullStepMonitor(), Locale.GERMANY,  "," ,  false );

 //		ParameterConverters.NumberConverter numberConverter =  new  ParameterConverters.NumberConverter(
 				germanNumbers);
 //		parameterConverters.addConverters(numberConverter);
 
		 Object  v = parameterConverters.convert(localizedString, BigDecimal.class);
		assertEquals(EXPECTED, v);
	}
 
  

 and it still fails with the same Exception. I tried with and without the two commented lines in the middle. Still the same error. 

 I do not think this is a problem of the Locale not getting picked up, but with the canonicalization of the String in  org.jbehave.core.steps.ParameterConverters.NumberConverter.canonicalize(String)  which seems to be producing the wrong "1.000.000.000.00" String (see that there is a lot of dots that will be mistaken for more than one decimal separators by the  BigDecimal(String)  constructor.              </div>
        </div>
    </div>
</div>
                             


<div id="comment-293927" class="issue-data-block activity-comment twixi-block  expanded">
    <div class="twixi-wrap verbose actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
            <div class="action-links">
                <a href="/Old_JBehave_Issues/739?focusedCommentId=293927&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-293927" title="A permanent link to this comment." class="icon icon-perma activitymodule-link"><span>Permalink</span></a>
                                            </div>
            <div class="action-details">        
    
    
    
                

    <a class="user-hover user-avatar" rel="alexlehm" id="commentauthor_293927_verbose" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=alexlehm"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Alexander Lehmann</a>
 added a comment  - <span class="commentdate_293927_verbose subText"><span class="date user-tz" title="12/Mar/12 7:30 PM"><time class="livestamp" datetime="2012-03-12T19:30-0500">12/Mar/12 7:30 PM</time></span></span>  </div>
        </div>
        <div class="action-body flooded"><p>I'm not quite sure what the reason for the canonicalize method is, either BigDecimal is not Locale capable and the method tries to fix that or it tries to fix a problem with the String parsing in BigDecimal, git blame gives this commit</p>

<p><a href="https://github.com/jbehave/jbehave-core/commit/13c03225d597c412060280e4912ead14c01605ba" class="external-link" rel="nofollow">https://github.com/jbehave/jbehave-core/commit/13c03225d597c412060280e4912ead14c01605ba</a></p>

<p>the reason why this is not working is probably that replace doesn't process regexp and replaceAll should be used instead, but I have to do a few more tests to actually be able to fix it.</p>

<p>(if the regex is applied correctly, I think the method will drop a minus sign)</p>
 </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
            <div class="action-details flooded">
                        
    
    
    
                

    <a class="user-hover user-avatar" rel="alexlehm" id="commentauthor_293927_concise" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=alexlehm"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Alexander Lehmann</a>
 added a comment  - <span class="commentdate_293927_concise subText"><span class="date user-tz" title="12/Mar/12 7:30 PM"><time class="livestamp" datetime="2012-03-12T19:30-0500">12/Mar/12 7:30 PM</time></span></span>                    I'm not quite sure what the reason for the canonicalize method is, either BigDecimal is not Locale capable and the method tries to fix that or it tries to fix a problem with the String parsing in BigDecimal, git blame gives this commit 

  https://github.com/jbehave/jbehave-core/commit/13c03225d597c412060280e4912ead14c01605ba  

 the reason why this is not working is probably that replace doesn't process regexp and replaceAll should be used instead, but I have to do a few more tests to actually be able to fix it. 

 (if the regex is applied correctly, I think the method will drop a minus sign) 
             </div>
        </div>
    </div>
</div>
                             


<div id="comment-294175" class="issue-data-block activity-comment twixi-block  expanded">
    <div class="twixi-wrap verbose actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
            <div class="action-links">
                <a href="/Old_JBehave_Issues/739?focusedCommentId=294175&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-294175" title="A permanent link to this comment." class="icon icon-perma activitymodule-link"><span>Permalink</span></a>
                                            </div>
            <div class="action-details">        
    
    
    
                

    <a class="user-hover user-avatar" rel="dschneller" id="commentauthor_294175_verbose" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=dschneller"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Daniel Schneller</a>
 added a comment  - <span class="commentdate_294175_verbose subText"><span class="date user-tz" title="15/Mar/12 5:51 AM"><time class="livestamp" datetime="2012-03-15T05:51-0500">15/Mar/12 5:51 AM</time></span></span>  </div>
        </div>
        <div class="action-body flooded"><p>I suggest this implementation of <tt>canonicalize</tt>.<br>
I don't have access to GitHub currently, so I cannot create a patch yet. I will do so, including the tests I have locally for it, when no objections come up:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>"ParametersConverters.java"</b></div><div class="codeContent panelContent">
<pre class="code-java">/**
	 * Canonicalized a number represented as a <span class="code-object">String</span> to a format suitable
	 * <span class="code-keyword">for</span> the BigDecimal(<span class="code-object">String</span>) constructor. Takes into account the
	 * settings of the currently configures NumberFormat.
	 * 
	 * @param value
	 *            a localized number string
	 * @<span class="code-keyword">return</span> the same number, but as a <span class="code-object">String</span> suitable <span class="code-keyword">for</span> consumption by
	 *         BigDecimal
	 */
	<span class="code-object">String</span> canonicalize(<span class="code-object">String</span> value) {
		<span class="code-object">char</span> decimalPointSeparator = '.'; <span class="code-comment">// <span class="code-keyword">default</span>
</span>		<span class="code-object">char</span> minusSign = '-'; <span class="code-comment">// <span class="code-keyword">default</span>
</span>		<span class="code-object">String</span> rxNotDigits = <span class="code-quote">"[^0-9]"</span>;
		StringBuilder returnBuilder = <span class="code-keyword">new</span> StringBuilder(value.length());

		<span class="code-comment">// override defaults according to numberFormat's settings
</span>		<span class="code-keyword">if</span> (numberFormat <span class="code-keyword">instanceof</span> DecimalFormat) {
			DecimalFormatSymbols decimalFormatSymbols = ((DecimalFormat) numberFormat)
					.getDecimalFormatSymbols();
			minusSign = decimalFormatSymbols.getMinusSign();
			decimalPointSeparator = decimalFormatSymbols
					.getDecimalSeparator();
		}

		value = value.trim();
		<span class="code-object">int</span> decimalPointPosition = value.lastIndexOf(decimalPointSeparator);
		<span class="code-object">boolean</span> isNegative = value.charAt(0) == minusSign;

		<span class="code-keyword">if</span> (isNegative) {
			returnBuilder.append('-'); <span class="code-comment">// fixed <span class="code-quote">"-"</span> <span class="code-keyword">for</span> BigDecimal
</span>										<span class="code-comment">// constructor
</span>		}

		<span class="code-keyword">if</span> (decimalPointPosition != -1) {
			<span class="code-object">String</span> sf = value.substring(0, decimalPointPosition)
					.replaceAll(rxNotDigits, "");
			<span class="code-object">String</span> dp = value.substring(decimalPointPosition + 1)
					.replaceAll(rxNotDigits, "");

			returnBuilder.append(sf);
			returnBuilder.append('.'); <span class="code-comment">// fixed <span class="code-quote">"."</span> <span class="code-keyword">for</span> BigDecimal
</span>										<span class="code-comment">// constructor
</span>			returnBuilder.append(dp);

		} <span class="code-keyword">else</span> {
			returnBuilder.append(value.replaceAll(rxNotDigits, ""));
		}
		<span class="code-keyword">return</span> returnBuilder.toString();
	}
</pre>
</div></div> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
            <div class="action-details flooded">
                        
    
    
    
                

    <a class="user-hover user-avatar" rel="dschneller" id="commentauthor_294175_concise" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=dschneller"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Daniel Schneller</a>
 added a comment  - <span class="commentdate_294175_concise subText"><span class="date user-tz" title="15/Mar/12 5:51 AM"><time class="livestamp" datetime="2012-03-15T05:51-0500">15/Mar/12 5:51 AM</time></span></span>                    I suggest this implementation of  canonicalize . 
I don't have access to GitHub currently, so I cannot create a patch yet. I will do so, including the tests I have locally for it, when no objections come up: 

   "ParametersConverters.java"   
 
/**
	 * Canonicalized a number represented as a  String  to a format suitable
	 *  for  the BigDecimal( String ) constructor. Takes into account the
	 * settings of the currently configures NumberFormat.
	 * 
	 * @param value
	 *            a localized number string
	 * @ return  the same number, but as a  String  suitable  for  consumption by
	 *         BigDecimal
	 */
	 String  canonicalize( String  value) {
		 char  decimalPointSeparator = '.';  //  default 
 		 char  minusSign = '-';  //  default 
 		 String  rxNotDigits =  "[^0-9]" ;
		StringBuilder returnBuilder =  new  StringBuilder(value.length());

		 // override defaults according to numberFormat's settings
 		 if  (numberFormat  instanceof  DecimalFormat) {
			DecimalFormatSymbols decimalFormatSymbols = ((DecimalFormat) numberFormat)
					.getDecimalFormatSymbols();
			minusSign = decimalFormatSymbols.getMinusSign();
			decimalPointSeparator = decimalFormatSymbols
					.getDecimalSeparator();
		}

		value = value.trim();
		 int  decimalPointPosition = value.lastIndexOf(decimalPointSeparator);
		 boolean  isNegative = value.charAt(0) == minusSign;

		 if  (isNegative) {
			returnBuilder.append('-');  // fixed  "-"   for  BigDecimal
 										 // constructor
 		}

		 if  (decimalPointPosition != -1) {
			 String  sf = value.substring(0, decimalPointPosition)
					.replaceAll(rxNotDigits, "");
			 String  dp = value.substring(decimalPointPosition + 1)
					.replaceAll(rxNotDigits, "");

			returnBuilder.append(sf);
			returnBuilder.append('.');  // fixed  "."   for  BigDecimal
 										 // constructor
 			returnBuilder.append(dp);

		}  else  {
			returnBuilder.append(value.replaceAll(rxNotDigits, ""));
		}
		 return  returnBuilder.toString();
	}
 
               </div>
        </div>
    </div>
</div>
                             

<div class="issue-data-block" id="changehistory-384628">
    <div class="actionContainer">
        <div class="action-details" id="changehistorydetails_384628">
                                

    <a class="user-hover user-avatar" rel="maurotalevi" id="changehistoryauthor_384628" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=maurotalevi"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Mauro Talevi</a>
 made changes  - <span class="date" title="15/Mar/12 6:23 AM"><time class="livestamp" datetime="2012-03-15T06:23-0500">15/Mar/12 6:23 AM</time></span>
        </div>
        <div class="changehistory action-body">
            <table id="changehistory_384628" border="0" cellpadding="0" cellspacing="0" width="100%">
                            <thead>
                    <tr>
                        <th width="20%">Field</th>
                        <th width="40%">Original Value</th>
                        <th width="40%">New Value</th>
                    </tr>
                </thead>
                            <tbody>
                            <tr>
                <td class="activity-name" width="20%">
                                    Fix Version/s
                                </td>
                <td class="activity-old-val" width="40%">
                                                </td>
                <td class="activity-new-val" width="40%">
                                                               3.6
                                                                                               <span class="hist-value">[    17721
]</span>
                                                    </td>
                </tr>
                            <tr>
                <td class="activity-name" width="20%">
                                    Affects Version/s
                                </td>
                <td class="activity-old-val" width="40%">
                                                </td>
                <td class="activity-new-val" width="40%">
                                                               3.5.4
                                                                                               <span class="hist-value">[    18081
]</span>
                                                    </td>
                </tr>
                            <tr>
                <td class="activity-name" width="20%">
                                    Affects Version/s
                                </td>
                <td class="activity-old-val" width="40%">
                                                                3.6
                                                                                                <span class="hist-value">[    17721
]</span>
                                                    </td>
                <td class="activity-new-val" width="40%">
                                                </td>
                </tr>
                            </tbody>
            </table>
        </div>
    </div>
</div>
                             


<div id="comment-294179" class="issue-data-block activity-comment twixi-block  expanded">
    <div class="twixi-wrap verbose actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-opened"><span>Hide</span></span></a>
            <div class="action-links">
                <a href="/Old_JBehave_Issues/739?focusedCommentId=294179&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-294179" title="A permanent link to this comment." class="icon icon-perma activitymodule-link"><span>Permalink</span></a>
                                            </div>
            <div class="action-details">        
    
    
    
                

    <a class="user-hover user-avatar" rel="maurotalevi" id="commentauthor_294179_verbose" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=maurotalevi"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Mauro Talevi</a>
 added a comment  - <span class="commentdate_294179_verbose subText"><span class="date user-tz" title="15/Mar/12 6:23 AM"><time class="livestamp" datetime="2012-03-15T06:23-0500">15/Mar/12 6:23 AM</time></span></span>  </div>
        </div>
        <div class="action-body flooded"><p>Applied patch with thanks.</p> </div>
    </div>
    <div class="twixi-wrap concise actionContainer">
        <div class="action-head">
            <a href="#" class="twixi"><span class="icon twixi-closed"><span>Show</span></span></a>
            <div class="action-details flooded">
                        
    
    
    
                

    <a class="user-hover user-avatar" rel="maurotalevi" id="commentauthor_294179_concise" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=maurotalevi"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Mauro Talevi</a>
 added a comment  - <span class="commentdate_294179_concise subText"><span class="date user-tz" title="15/Mar/12 6:23 AM"><time class="livestamp" datetime="2012-03-15T06:23-0500">15/Mar/12 6:23 AM</time></span></span>                    Applied patch with thanks.              </div>
        </div>
    </div>
</div>
                             

<div class="issue-data-block" id="changehistory-384630">
    <div class="actionContainer">
        <div class="action-details" id="changehistorydetails_384630">
                                

    <a class="user-hover user-avatar" rel="maurotalevi" id="changehistoryauthor_384630" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=maurotalevi"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Mauro Talevi</a>
 made changes  - <span class="date" title="15/Mar/12 6:23 AM"><time class="livestamp" datetime="2012-03-15T06:23-0500">15/Mar/12 6:23 AM</time></span>
        </div>
        <div class="changehistory action-body">
            <table id="changehistory_384630" border="0" cellpadding="0" cellspacing="0" width="100%">
                            <tbody>
                            <tr>
                <td class="activity-name" width="20%">
                                    Status
                                </td>
                <td class="activity-old-val" width="40%">
                                                                Open
                                                                                                <span class="hist-value">[    1
]</span>
                                                    </td>
                <td class="activity-new-val" width="40%">
                                                               Resolved
                                                                                               <span class="hist-value">[    5
]</span>
                                                    </td>
                </tr>
                            <tr>
                <td class="activity-name" width="20%">
                                    Resolution
                                </td>
                <td class="activity-old-val" width="40%">
                                                </td>
                <td class="activity-new-val" width="40%">
                                                               Fixed
                                                                                               <span class="hist-value">[    1
]</span>
                                                    </td>
                </tr>
                            </tbody>
            </table>
        </div>
    </div>
</div>
                             

<div class="issue-data-block" id="changehistory-384631">
    <div class="actionContainer">
        <div class="action-details" id="changehistorydetails_384631">
                                

    <a class="user-hover user-avatar" rel="maurotalevi" id="changehistoryauthor_384631" href="https://jira.codehaus.org/secure/ViewProfile.jspa?name=maurotalevi"><span class="aui-avatar aui-avatar-xsmall"><span class="aui-avatar-inner"><img src="index_files/useravatar.png"></span></span> Mauro Talevi</a>
 made changes  - <span class="date" title="15/Mar/12 6:23 AM"><time class="livestamp" datetime="2012-03-15T06:23-0500">15/Mar/12 6:23 AM</time></span>
        </div>
        <div class="changehistory action-body">
            <table id="changehistory_384631" border="0" cellpadding="0" cellspacing="0" width="100%">
                            <tbody>
                            <tr>
                <td class="activity-name" width="20%">
                                    Summary
                                </td>
                <td class="activity-old-val" width="40%">
                                                                NumberFormatException when trying to convert parameters to BigDecimal with Locale
                                                                    </td>
                <td class="activity-new-val" width="40%">
                                                               NumberFormatException when trying to convert parameters to BigDecimal with German Locale
                                                                    </td>
                </tr>
                            </tbody>
            </table>
        </div>
    </div>
</div>
                             </div>
    </div>
</div></div></div><div id="viewissuesidebar" class="aui-item issue-side-column"><div id="peoplemodule" class="module toggle-wrap"><div id="peoplemodule_heading" class="mod-header"><ul class="ops"></ul><h2 class="toggle-title">People</h2></div><div class="mod-content"><ul class="item-details" id="peopledetails">
    <li class="people-details">
                <dl>
            <dt>Assignee:</dt>
            <dd>
                <span id="assignee-val" class="view-issue-field">

    <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="index_files/useravatar-1.png"></span></span>
    Unassigned
</span>
                            </dd>
        </dl>
                        <dl>
            <dt>Reporter:</dt>
            <dd>
                <span id="reporter-val" class="view-issue-field">

            <span class="user-hover" id="issue_summary_reporter_dschneller" rel="dschneller">
            <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="index_files/useravatar-2.png"></span></span>
            Daniel Schneller
        </span>
    </span>
            </dd>
        </dl>
                    </li>
</ul>
    <ul class="item-details">
        <li>
                            <dl>
                    <dt>Votes:</dt>
                    <dd>
                                                                            <span id="vote-data" class="aui-badge vote-state-off">0</span>
                        
                                                                                                        <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span>
                                            </dd>
                </dl>
                                        <dl>
                    <dt>Watchers:</dt>
                    <dd>
                                                                        
                                                                            <span id="watcher-data" class="aui-badge watch-state-off">0</span>
                        
                                                                                <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span>
                                            </dd>
                </dl>
                    </li>
    </ul>
</div></div><div id="datesmodule" class="module toggle-wrap"><div id="datesmodule_heading" class="mod-header"><ul class="ops"></ul><h2 class="toggle-title">Dates</h2></div><div class="mod-content"><ul class="item-details">
    <li>
            <dl class="dates">
            <dt>Created:</dt>
            <dd class="date user-tz" title="12/Mar/12 6:20 AM">

                <span data-name="Created" id="create-date" data-fieldtype="datetime">
                                                                        <time class="livestamp" datetime="2012-03-12T06:20-0500">12/Mar/12 6:20 AM</time>                                                             </span>
            </dd>
        </dl>
            <dl class="dates">
            <dt>Updated:</dt>
            <dd class="date user-tz" title="15/Mar/12 6:23 AM">

                <span data-name="Updated" id="updated-date" data-fieldtype="datetime">
                                                                        <time class="livestamp" datetime="2012-03-15T06:23-0500">15/Mar/12 6:23 AM</time>                                                             </span>
            </dd>
        </dl>
            <dl class="dates">
            <dt>Resolved:</dt>
            <dd class="date user-tz" title="15/Mar/12 6:23 AM">

                <span data-name="Resolved" id="resolved-date" data-fieldtype="datetime">
                                                                        <time class="livestamp" datetime="2012-03-15T06:23-0500">15/Mar/12 6:23 AM</time>                                                             </span>
            </dd>
        </dl>
        </li>
</ul>
</div></div></div></div>
                    </div>
                </div>
                        </div>

    <fieldset class="hidden parameters">
        <input title="autocompleteEnabled" value="true" type="hidden">
    </fieldset>
    
    </section>
    <footer id="footer" role="contentinfo">
        
        



<div class="footer-body">
    <ul>
        <li>
                        <a href="http://www.atlassian.com/software/jira">Atlassian JIRA</a>

                                                    
                        
            <span id="footer-build-information">(v6.1.6#6162-<span title="7af547ce7c84dbb7c1e345a65437ed7b85efffa2" data-commit-id="7af547ce7c84dbb7c1e345a65437ed7b85efffa2}">sha1:7af547c</span>)</span>
        </li>
        <li>
            <a id="about-link" href="https://jira.codehaus.org/secure/AboutPage.jspa">About JIRA</a>
        </li>
        <li>
                                    <a id="footer-report-problem-link" href="https://jira.codehaus.org/secure/CreateIssue%21default.jspa">Report a problem</a>
        </li>
    </ul>
            <ul>
            <li class="licensemessage">
                                    Powered by a free Atlassian <a href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Codehaus. Try JIRA - <a href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team.

                            </li>
        </ul>
    </div>

<form id="jira_request_timing_info" class="dont-default-focus">
	<fieldset class="parameters hidden">




		<input title="jira.session.expiry.in.mins" value="299" type="hidden">

	</fieldset>
</form>
<!--
	                 
	          
	               
	                 
	        CONCURRENT REQUESTS : 1



-->










<fieldset class="hidden parameters">
    <input title="loggedInUser" value="" type="hidden">
    <input title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation." type="hidden">
    <input title="JiraVersion" value="6.1.6" type="hidden">
    <input title="ajaxUnauthorised" value="You are not authorised to perform this operation.  Please log in." type="hidden">
    <input title="baseURL" value="https://jira.codehaus.org:443" type="hidden">
    <input title="ajaxCommsError" value="The JIRA server could not be contacted.  This may be a temporary glitch or the server may be down." type="hidden">
    <input title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation." type="hidden">
    <input title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser" type="hidden">
    <input title="ajaxErrorDialogHeading" value="Communications Breakdown" type="hidden">

    <input title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost." type="hidden">
    <input title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog." type="hidden">
    <input title="keyType" value="Type" type="hidden">
    <input title="keyThen" value="then" type="hidden">
    <input title="dblClickToExpand" value="Double click to expand" type="hidden">
    <input title="actions" value="Actions" type="hidden">
    <input title="removeItem" value="Remove" type="hidden">
    <input title="workflow" value="Workflow" type="hidden">
    <input title="labelNew" value="New Label" type="hidden">
    <input title="issueActionsHint" value="Begin typing for available operations or press down to see all" type="hidden">
    <input title="closelink" value="Close" type="hidden">
    <input title="dotOperations" value="Operations" type="hidden">
    <input title="dotLoading" value="Loading..." type="hidden">
    <input title="frotherSuggestions" value="Suggestions" type="hidden">
    <input title="frotherNomatches" value="No Matches" type="hidden">
    <input title="multiselectVersionsError" value="{0} is not a valid version." type="hidden">
    <input title="multiselectComponentsError" value="{0} is not a valid component." type="hidden">
    <input title="multiselectGenericError" value="The value {0} is invalid." type="hidden">
</fieldset>

    </footer>
</div>


<div id="fancybox-tmp"></div><div id="fancybox-loading"><div></div></div><div id="fancybox-overlay"></div><div id="fancybox-wrap"><div id="fancybox-outer"><div class="fancybox-bg" id="fancybox-bg-n"></div><div class="fancybox-bg" id="fancybox-bg-ne"></div><div class="fancybox-bg" id="fancybox-bg-e"></div><div class="fancybox-bg" id="fancybox-bg-se"></div><div class="fancybox-bg" id="fancybox-bg-s"></div><div class="fancybox-bg" id="fancybox-bg-sw"></div><div class="fancybox-bg" id="fancybox-bg-w"></div><div class="fancybox-bg" id="fancybox-bg-nw"></div><div id="fancybox-content"></div><a id="fancybox-close"></a><div id="fancybox-title"></div><a href="javascript:void(0);" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a><a href="javascript:void(0);" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a></div></div><div class="navigator-sidebar collapsed ui-popout ui-popout-detached ui-popout-collapsed" id="navigator-sidebar"><a class="toggle-filter-panel" href="#" title="Dock the filters panel ([)"></a></div><div style="display: none;" class="jira-dialog box-shadow" id="edit-issue-dialog"><div class="jira-dialog-content"></div></div><div style="display: none;" class="jira-dialog box-shadow" id="create-subtask-dialog"><div class="jira-dialog-content"></div></div></body></html>